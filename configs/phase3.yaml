# ============================================
# Phase 3 é…ç½® - HRLå¼ºåŒ–å­¦ä¹  + é»‘åå•ç®¡ç†ç³»ç»Ÿï¼ˆæ—¶é—´æ§½ç‰ˆæœ¬ï¼‰
# ============================================

# ============================================
# 1. é˜¶æ®µ3åŸºç¡€é…ç½®
# ============================================
phase3:
  output_dir: "${project.base_dir}/phase3"
  num_episodes: 1000              # è®­ç»ƒè½®æ•°
  max_steps: 3000000              # æ€»æ­¥æ•°ä¸Šé™
  max_steps_per_episode: 600      # å•ä¸ªEpisodeæœ€å¤§æ­¥æ•°ï¼ˆå†³ç­–æ­¥æ•°ï¼Œä¸æ˜¯æ—¶é—´ï¼ï¼‰
  episodes: 2000
  # è¯„ä¼°é…ç½®
  eval_every: 100                 # æ¯100ä¸ªEpisodeè¯„ä¼°ä¸€æ¬¡
  eval_episodes: 20               # æ¯æ¬¡è¯„ä¼°è¿è¡Œ20ä¸ªEpisode
  save_every: 100                 # æ¯100ä¸ªEpisodeä¿å­˜ä¸€æ¬¡

  # æ›´æ–°é¢‘ç‡
  update_frequency: 4             # æ¯4æ­¥æ›´æ–°ä¸€æ¬¡ç­–ç•¥

  # âœ… DAggeré…ç½®ï¼ˆæ™ºèƒ½ä¸“å®¶è¿‡æ»¤ï¼‰
  use_dagger: true
  beta_start: 0.5                 # åˆå§‹ä¸“å®¶ä½¿ç”¨æ¦‚ç‡
  beta_end: 0.1                   # æœ€ç»ˆä¸“å®¶ä½¿ç”¨æ¦‚ç‡
  beta_min: 0.05                  # æœ€å°betaå€¼
  beta_decay: 0.995               # æ¯ä¸ªEpisodeåbetaè¡°å‡ç‡

  # ğŸ”¥ æ–°å¢ï¼šæ—¶é—´æ§½ç³»ç»Ÿé…ç½®
  timeslot:
    enabled: true                 # å¯ç”¨æ—¶é—´æ§½ç³»ç»Ÿ
    delta_t: 0.01                 # æ—¶é—´æ§½å¤§å°ï¼ˆç§’ï¼‰= 10ms
    max_time_slots: 200000        # æœ€å¤§æ—¶é—´æ§½æ•°

    # è¯·æ±‚æŒç»­æ—¶é—´
    request_duration:
      min_slots: 1000             # æœ€å°æŒç»­æ—¶é—´ = 10s
      max_slots: 6000             # æœ€å¤§æŒç»­æ—¶é—´ = 60s

    # ç»Ÿè®¡é…ç½®
    log_timeslot_info: true       # è®°å½•æ—¶é—´æ§½ä¿¡æ¯
    log_jumps: true               # è®°å½•æ—¶é—´æ§½è·³è½¬

# ============================================
# 2. é»‘åå•ç®¡ç†é…ç½®ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
# ============================================
blacklist:
  # å†·å´æ—¶é—´é…ç½®
  cooldown_base: 5                # é¦–æ¬¡å¤±è´¥å†·å´5æ­¥
  cooldown_max: 20                # æœ€å¤šå†·å´20æ­¥ï¼ˆä¸Šé™ï¼‰
  cooldown_multiplier: 2          # æ¯æ¬¡å¤±è´¥æ—¶é—´ç¿»å€ï¼ˆ5â†’10â†’20ï¼‰

  # æ¸…ç†ç­–ç•¥
  cleanup_interval: 3             # æ¯3æ­¥æ¸…ç†ä¸€æ¬¡è¿‡æœŸé»‘åå•
  min_valid_actions: 3            # å¯ç”¨åŠ¨ä½œå°‘äº3ä¸ªæ—¶è§¦å‘åº”æ€¥æ¸…ç†

  # èµ„æºæ£€æŸ¥
  resource_check_margin: 1.1      # èµ„æºæ£€æŸ¥æ—¶ç•™10%ä½™é‡

# ============================================
# 3. HRLé…ç½®ï¼ˆåˆ†å±‚å¼ºåŒ–å­¦ä¹ ï¼‰
# ============================================
hrl:
  # çŠ¶æ€è¡¨ç¤º
  state_dim: 128                  # çŠ¶æ€ç»´åº¦
  goal_dim: 64                    # ç›®æ ‡ç»´åº¦
  hidden_dim: 128                 # éšè—å±‚ç»´åº¦

  # å­ç›®æ ‡é…ç½®
  subgoal_horizon: 20             # å­ç›®æ ‡æœ€å¤§æŒç»­æ­¥æ•°
  intrinsic_reward_weight: 0.3    # å†…åœ¨å¥–åŠ±æƒé‡

  # ç›®æ ‡ç­–ç•¥
  goal_strategy: 'adaptive'       # è‡ªé€‚åº”ç›®æ ‡é€‰æ‹©ç­–ç•¥
  max_complexity_threshold: 0.8   # æœ€å¤§å¤æ‚åº¦é˜ˆå€¼

  # âœ… è‡ªé€‚åº”Epsilonï¼ˆé»‘åå•æ„ŸçŸ¥ï¼‰
  adaptive_epsilon: true          # å¯ç”¨è‡ªé€‚åº”æ¢ç´¢ç‡
  epsilon_adjustment_factor: 0.3  # é»‘åå•è°ƒæ•´ç³»æ•°ï¼ˆé»‘åå•å¤šâ†’é™ä½æ¢ç´¢ï¼‰

# ============================================
# 4. æ¢ç´¢ç­–ç•¥ï¼ˆEpsiloné…ç½®ï¼‰
# ============================================
epsilon:
  # High-Levelç­–ç•¥æ¢ç´¢
  high:
    initial: 0.9                  # åˆå§‹æ¢ç´¢ç‡30%
    final: 0.05                   # æœ€ç»ˆæ¢ç´¢ç‡5%
    decay_steps: 300000            # 50000æ­¥çº¿æ€§è¡°å‡

  # Low-Levelç­–ç•¥æ¢ç´¢
  low:
    initial: 0.9                  # åˆå§‹æ¢ç´¢ç‡30%
    final: 0.05                   # æœ€ç»ˆæ¢ç´¢ç‡5%
    decay_steps: 300000            # 50000æ­¥çº¿æ€§è¡°å‡
    min: 0.01                     # æœ€ä½æ¢ç´¢ç‡1%ï¼ˆé»‘åå•æ„ŸçŸ¥æ—¶çš„ä¸‹é™ï¼‰

# ============================================
# 5. RLè®­ç»ƒå‚æ•°
# ============================================
rl:
  # åŸºç¡€å‚æ•°
  gamma: 0.99                     # æŠ˜æ‰£å› å­
  learning_rate: 0.0001           # å­¦ä¹ ç‡

  # ç»éªŒå›æ”¾
  replay_buffer:
    capacity: 100000              # ç¼“å†²åŒºå®¹é‡
    batch_size: 128               # æ‰¹æ¬¡å¤§å°
    min_size: 1000                # å¼€å§‹å­¦ä¹ çš„æœ€å°æ ·æœ¬æ•°

  # ç›®æ ‡ç½‘ç»œæ›´æ–°
  target_update_freq: 200         # æ¯200æ­¥æ›´æ–°ç›®æ ‡ç½‘ç»œ

  # ä¼˜åŒ–å™¨
  optimizer: 'adam'               # Adamä¼˜åŒ–å™¨
  gradient_clip: 1.0              # æ¢¯åº¦è£å‰ª

# ============================================
# 6. å¥–åŠ±å‡½æ•°é…ç½®ï¼ˆV5.6ç‰ˆæœ¬ + æ—¶é—´æ§½å¢å¼ºï¼‰
# ============================================
reward:
  # ----------------------------------------
  # 6.1 VNFéƒ¨ç½²é˜¶æ®µ
  # ----------------------------------------
  vnf:
    deploy_success: 40.0          # å•ä¸ªVNFéƒ¨ç½²æˆåŠŸ
    all_complete: 50.0            # æ‰€æœ‰VNFéƒ¨ç½²å®Œæˆ
    deploy_failed: -30.0          # VNFéƒ¨ç½²å¤±è´¥
    move_to_dc_bonus: 5.0         # ç§»åŠ¨åˆ°DCèŠ‚ç‚¹å¥–åŠ±
    move_cost: -1               # ç§»åŠ¨æˆæœ¬

  # ----------------------------------------
  # 6.2 æ ‘æ„å»ºé˜¶æ®µ
  # ----------------------------------------
  tree:
    # è¿æ¥å¥–åŠ±ï¼ˆæŒ‡æ•°å¢é•¿ï¼‰
    connection_base: 50.0         # åŸºç¡€è¿æ¥å¥–åŠ±
    connection_exponential: 1.5   # æŒ‡æ•°ç³»æ•°ï¼ˆ50 * 1.5^nï¼‰
    connection_progress_bonus: 50.0  # è¿›åº¦å¥–åŠ±
    dest_reached_bonus: 30.0      # åˆ°è¾¾ç›®çš„åœ°å¥–åŠ±
    full_completion_bonus: 300.0  # å…¨éƒ¨å®Œæˆå¥–åŠ±

    # è·ç¦»å¼•å¯¼
    guidance_closer_rate: 3.0     # é è¿‘ç›®æ ‡å¥–åŠ±ç³»æ•°
    guidance_farther_penalty: -1.0  # è¿œç¦»ç›®æ ‡æƒ©ç½š
    guidance_idle_penalty: -0.5   # åŸåœ°ä¸åŠ¨æƒ©ç½š

  # ----------------------------------------
  # 6.3 æƒ©ç½š
  # ----------------------------------------
  penalty:
    invalid_link: -10.0           # æ— æ•ˆé“¾è·¯
    invalid_action: -15.0         # æ— æ•ˆåŠ¨ä½œ
    wrong_position: -5.0          # é”™è¯¯ä½ç½®

    # âœ… é¢‘æ¬¡æƒ©ç½šï¼ˆè½»é‡åŒ–ï¼‰
    freq_penalty_threshold: 20    # è®¿é—®20æ¬¡åå¼€å§‹æƒ©ç½š
    freq_penalty_rate: -1.0       # æƒ©ç½šç³»æ•°ï¼ˆè½»å¾®ï¼‰
    hub_penalty_exempt: true      # HubèŠ‚ç‚¹å…é™¤é¢‘æ¬¡æƒ©ç½š

  # ----------------------------------------
  # 6.4 è¶…æ—¶å¤„ç†ï¼ˆæ—¶é—´æ§½å¢å¼ºï¼‰
  # ----------------------------------------
  timeout:
    # ğŸ”¥ æ–°å¢ï¼šåŸºäºæ—¶é—´æ§½çš„è¶…æ—¶æ£€æµ‹
    enable_timeslot_timeout: true     # å¯ç”¨æ—¶é—´æ§½è¶…æ—¶æ£€æµ‹
    max_decision_steps: 600           # æœ€å¤§å†³ç­–æ­¥æ•°ï¼ˆä¸phase3.max_steps_per_episodeä¸€è‡´ï¼‰

    # åŸæœ‰é…ç½®
    high_progress_threshold: 0.8      # é«˜è¿›åº¦é˜ˆå€¼ï¼ˆ80%ï¼‰
    bonus_rate: 50.0                  # é«˜è¿›åº¦è¶…æ—¶å¥–åŠ±
    penalty_rate: -50.0               # ä½è¿›åº¦è¶…æ—¶æƒ©ç½š
    vnf_timeout_penalty: -50.0        # VNFé˜¶æ®µè¶…æ—¶æƒ©ç½š

    # ğŸ”¥ æ–°å¢ï¼šè¶…æ—¶æƒ©ç½šå¼ºåŒ–
    base_timeout_penalty: -300.0      # åŸºç¡€è¶…æ—¶æƒ©ç½šï¼ˆæ›´é‡ï¼‰
    resource_waste_penalty: -100.0    # èµ„æºæµªè´¹æƒ©ç½š

  # ----------------------------------------
  # 6.5 å…¨å±€é…ç½®
  # ----------------------------------------
  reward_scale: 1.0               # å¥–åŠ±ç¼©æ”¾å› å­
  use_reward_shaping: true        # å¯ç”¨å¥–åŠ±å¡‘å½¢

# ============================================
# 7. ç¯å¢ƒé…ç½®
# ============================================
environment:
  num_nodes: 28                   # èŠ‚ç‚¹æ•°
  nb_high_level_goals: 10         # High-Levelç›®æ ‡æ•°é‡
  nb_low_level_actions: 28        # Low-LevelåŠ¨ä½œæ•°ï¼ˆç­‰äºèŠ‚ç‚¹æ•°ï¼‰

  # ğŸ”¥ æ–°å¢ï¼šæ—¶é—´æ§½ç³»ç»Ÿ
  time_slot_delta: 0.01           # æ—¶é—´æ§½å¤§å°ï¼ˆç§’ï¼‰
  max_steps_per_episode: 600      # æœ€å¤§å†³ç­–æ­¥æ•°

  # æ‹“æ‰‘é…ç½®
  topology:
    type: 'us_backbone'           # æ‹“æ‰‘ç±»å‹
    dc_nodes: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 23]

  # èµ„æºé…ç½®
  capacities:
    cpu: 100.0                    # CPUå®¹é‡
    memory: 80.0                  # å†…å­˜å®¹é‡
    bandwidth: 100.0              # å¸¦å®½å®¹é‡

# ============================================
# 8. VNFé…ç½®
# ============================================
vnf:
  n_types: 8                      # VNFç±»å‹æ•°
  max_chain_length: 5             # æœ€å¤§VNFé“¾é•¿åº¦

  # èµ„æºéœ€æ±‚ï¼ˆç¤ºä¾‹ï¼‰
  resource_requirements:
    default_cpu: 1.0
    default_memory: 1.0
    default_bandwidth: 1.0

# ============================================
# 9. æ—©åœç­–ç•¥
# ============================================
early_stopping:
  enabled: true                   # å¯ç”¨æ—©åœ
  patience: 50                    # å®¹å¿50ä¸ªEpisodeæ— æ”¹è¿›
  min_improvement: 0.01           # æœ€å°æ”¹è¿›é˜ˆå€¼1%
  metric: 'acceptance_rate'       # ç›‘æ§æŒ‡æ ‡

# ============================================
# 10. æ£€æŸ¥ç‚¹é…ç½®
# ============================================
checkpoint:
  save_freq: 25                   # æ¯25ä¸ªEpisodeä¿å­˜ä¸€æ¬¡
  keep_best: true                 # ä¿ç•™æœ€ä½³æ¨¡å‹
  metric: 'acceptance_rate'       # è¯„ä¼°æŒ‡æ ‡
  save_optimizer: true            # ä¿å­˜ä¼˜åŒ–å™¨çŠ¶æ€

# ============================================
# 11. è¯¾ç¨‹å­¦ä¹ é…ç½®ï¼ˆå¯é€‰ï¼‰
# ============================================
curriculum:
  use_curriculum: true            # å¯ç”¨è¯¾ç¨‹å­¦ä¹ 
  stages: 3                       # 3ä¸ªé˜¶æ®µ
  initial_expert_ratio: 0.8       # åˆå§‹ä¸“å®¶æ¯”ä¾‹80%
  final_expert_ratio: 0.0         # æœ€ç»ˆä¸“å®¶æ¯”ä¾‹0%
  stage_episodes: [200, 400, 300] # æ¯é˜¶æ®µEpisodeæ•°

# ============================================
# 12. æ—¥å¿—å’Œç›‘æ§ï¼ˆæ—¶é—´æ§½å¢å¼ºï¼‰
# ============================================
logging:
  level: 'INFO'                   # æ—¥å¿—çº§åˆ«
  console: true                   # æ§åˆ¶å°è¾“å‡º
  file: true                      # æ–‡ä»¶è¾“å‡º
  tensorboard: true               # TensorBoardè®°å½•

  # è®°å½•é¢‘ç‡
  log_episode_freq: 10            # æ¯10ä¸ªEpisodeè®°å½•è¯¦ç»†ä¿¡æ¯
  log_step_freq: 100              # æ¯100æ­¥è®°å½•è®­ç»ƒä¿¡æ¯

  # é»‘åå•ç›‘æ§
  log_blacklist: true             # è®°å½•é»‘åå•ä¿¡æ¯
  log_failures: true              # è®°å½•å¤±è´¥ç»Ÿè®¡

  # ğŸ”¥ æ–°å¢ï¼šæ—¶é—´æ§½ç›‘æ§
  log_timeslot:
    enabled: true                 # å¯ç”¨æ—¶é—´æ§½æ—¥å¿—
    log_jumps: true               # è®°å½•æ—¶é—´æ§½è·³è½¬
    log_expiry: true              # è®°å½•è¯·æ±‚åˆ°æœŸ
    log_resource_release: true    # è®°å½•èµ„æºé‡Šæ”¾
    detail_level: 'normal'        # è¯¦ç»†çº§åˆ«ï¼ˆminimal/normal/verboseï¼‰

# ============================================
# 13. åŠ¨æ€ç¯å¢ƒé…ç½®ï¼ˆæœåŠ¡ç”Ÿå‘½å‘¨æœŸ + æ—¶é—´æ§½ï¼‰
# ============================================
dynamic_env:
  enabled: true                   # å¯ç”¨åŠ¨æ€ç¯å¢ƒ

  # ğŸ”¥ åŸæœ‰é…ç½®ï¼ˆä»¥Episodeä¸ºå•ä½ï¼‰
  service_lifetime_min: 50        # æœ€å°æœåŠ¡ç”Ÿå‘½å‘¨æœŸï¼ˆEpisodeï¼‰
  service_lifetime_max: 200       # æœ€å¤§æœåŠ¡ç”Ÿå‘½å‘¨æœŸï¼ˆEpisodeï¼‰

  # ğŸ”¥ æ–°å¢ï¼šæ—¶é—´æ§½ç‰ˆæœ¬ï¼ˆä»¥æ—¶é—´æ§½ä¸ºå•ä½ï¼‰
  timeslot_based_lifetime: true   # ä½¿ç”¨æ—¶é—´æ§½è®¡ç®—ç”Ÿå‘½å‘¨æœŸ
  lifetime_min_slots: 1000        # æœ€å°ç”Ÿå‘½å‘¨æœŸï¼ˆæ—¶é—´æ§½ï¼‰= 10s
  lifetime_max_slots: 6000        # æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼ˆæ—¶é—´æ§½ï¼‰= 60s

# ============================================
# 14. è·¯å¾„é…ç½®
# ============================================
path:
  input_dir: 'data/input_dir'
  output_dir: 'outputs/phase3'
  expert_data_dir: 'data/expert'
  checkpoint_dir: 'checkpoints/phase3'
  log_dir: 'logs/phase3'
  tensorboard_dir: 'runs/phase3'

  # ğŸ”¥ æ–°å¢ï¼šæ—¶é—´æ§½æ•°æ®æ–‡ä»¶
  requests_file: 'phase3_requests.pkl'
  requests_by_slot_file: 'phase3_requests_by_slot.pkl'
  events_by_slot_file: 'phase3_events_by_slot.pkl'

# ============================================
# 15. é¡¹ç›®å…¨å±€é…ç½®
# ============================================
project:
  base_dir: '.'
  name: 'HRL-GNN-SFC'
  version: '3.0-timeslot'         # ğŸ”¥ ç‰ˆæœ¬æ›´æ–°
  seed: 42                        # éšæœºç§å­

# ============================================
# 16. ğŸ”¥ æ—¶é—´æ§½ç³»ç»Ÿå…¨å±€é…ç½®ï¼ˆæ–°å¢ï¼‰
# ============================================
timeslot_system:
  # åŸºæœ¬é…ç½®
  enabled: true                   # å…¨å±€å¯ç”¨æ—¶é—´æ§½ç³»ç»Ÿ
  delta_t: 0.01                   # æ—¶é—´æ§½å¤§å°ï¼ˆç§’ï¼‰
  max_time_slots: 200000          # æœ€å¤§æ—¶é—´æ§½æ•°

  # è¯·æ±‚ç®¡ç†
  request_management:
    batch_processing: true        # æ‰¹é‡å¤„ç†åŒæ—¶é—´æ§½è¯·æ±‚
    max_batch_size: 10            # æœ€å¤§æ‰¹é‡å¤§å°
    enable_priority: false        # å¯ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—

  # èµ„æºç®¡ç†
  resource_management:
    auto_release: true            # è‡ªåŠ¨é‡Šæ”¾è¿‡æœŸèµ„æº
    check_before_allocate: true   # åˆ†é…å‰æ£€æŸ¥
    track_by_request: true        # æŒ‰è¯·æ±‚è¿½è¸ªèµ„æº

  # æ€§èƒ½ä¼˜åŒ–
  optimization:
    cache_enabled: true           # å¯ç”¨ç¼“å­˜
    cache_size: 1000              # ç¼“å­˜å¤§å°
    skip_empty_slots: true        # è·³è¿‡ç©ºæ—¶é—´æ§½

  # è°ƒè¯•ä¸éªŒè¯
  debug:
    validate_timestamps: true     # éªŒè¯æ—¶é—´æˆ³ä¸€è‡´æ€§
    check_resource_leak: true     # æ£€æŸ¥èµ„æºæ³„æ¼
    log_anomalies: true           # è®°å½•å¼‚å¸¸æƒ…å†µ